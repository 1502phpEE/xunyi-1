(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";var URL_FILE_UPLOAD="/files/save_to_upyun/?type=image&return_full=true",DEFAULTS={runtimes:"html5,flash,silverlight,html4",browse_button:"btn-choose-img",url:URL_FILE_UPLOAD,multipart_params:{type:"image"},filters:{max_file_size:"10mb",mime_types:[{title:"图片文件",extensions:"jpg,jpeg,gif,png,jpe"}]},flash_swf_url:"/static/libs/plupload/2.1.4/Moxie.swf",silverlight_xap_url:"/static/libs/plupload/2.1.4/Moxie.xap",init:{PostInit:function(e){console.log("uploader init!")},FilesAdded:function(e,t){},FileUploaded:function(e,t,i){},UploadProgress:function(e,t){},UploadComplete:function(e,t){},Error:function(e,t){}}};module.exports=function(e){return e=$.extend({},DEFAULTS,e),new plupload.Uploader(e)};
},{}],2:[function(require,module,exports){
"use strict";var ALERT_TPL=Handlebars.compile('<div class="alert alert-{{msgType}} alert-dismissible fade in" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button> {{ content }} </div>');$.fn.alertShow=function(e,t){var n=$(this);t=t||"danger";var r=$(ALERT_TPL({content:e,msgType:t}));n.html(r).data("bs-alert-obj",r)},$.fn.alertHide=function(){var e=$(this),t=e.data("bs-alert-obj");t&&t.alert("close")},$.parseHash=function(){for(var e,t={},n=/\+/g,r=/([^&;=]+)=?([^&;]*)/g,s=function(e){return decodeURIComponent(e.replace(n," "))},i=window.location.hash.substring(1);e=r.exec(i);)t[s(e[1])]=s(e[2]);return t},$.generateGuid=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},$.fn.popoverMsg=function(e,t){var n=$(this);t=t||3e3,n.popover({content:e,html:!0,trigger:"manual",placement:"bottom"}).popover("show"),setTimeout(function(){n.popover("destroy")},t)},$.fn.bodyClickHide=function(e){var t=$(this),n=$(e);$(document).on("click",function(e){t.has(e.target).length>0||t.is(e.target)||n.has(e.target).length>0||n.is(e.target)?console.log("点击在隐藏元素本身或排除元素上！"):t.hide()})},Handlebars.registerHelper("ifCond",function(e,t,n,r){switch(t){case"==":return e==n?r.fn(this):r.inverse(this);case"===":return e===n?r.fn(this):r.inverse(this);case"<":return n>e?r.fn(this):r.inverse(this);case"<=":return n>=e?r.fn(this):r.inverse(this);case">":return e>n?r.fn(this):r.inverse(this);case">=":return e>=n?r.fn(this):r.inverse(this);case"&&":return e&&n?r.fn(this):r.inverse(this);case"||":return e||n?r.fn(this):r.inverse(this);default:return r.inverse(this)}}),window.console&&window.console.log||(window.console={log:function(){}});
},{}],3:[function(require,module,exports){
"use strict";function getProblemData(){var e=$.trim($("#txt-content").val()),o=parseInt($.trim($("#txt-age").val()),10);o=isNaN(o)?"":o;var i=$(".gender:checked").val(),t=[];return $.each($(".up-file-img-preview"),function(e,o){t.push($(o).prop("src"))}),{content:e,age:o,gender:i,imgList:t}}function setProblemData(e){$("#txt-content").val(e.content),$("#txt-age").val(e.age),$(".gender[value="+e.gender+"]").prop("checked",!0),$.each(e.imgList,function(e,o){$("#img-list").append('<span class="up-file-img" ><img class="up-file-img-preview" src="'+o+'" /></span>')}),updateUploadedImgCount()}function validateProblemData(e){var o=null;return!e.content||e.content.length<=10?o="请输入10字以上的问题描述":!/^\d+$/.test(e.age)||e.age>180?o="请输入正确的年龄":e.gender?isUploading&&(o="正在上传图片，请稍后"):o="请选择您的性别",o}function updateUploadedImgCount(){var e=$(".up-file-img-preview").length,o=e>0?'添加图片 <span class="badge">'+e+"</span>":"添加图片";$("#btn-add-img").html(o)}function restoreProblemDataFromCookie(){var e=$.cookie(problemDataCookieKey);e&&(e=JSON.parse(e),setProblemData(e))}function saveProblemDataToCookie(e){$.cookie(problemDataCookieKey,JSON.stringify(e),{expires:1,path:"/",domain:".chunyuyisheng.com"}),$.cookie(problemDataCookieKey,JSON.stringify(e),{expires:1,path:"/",domain:".chunyu.mobi"})}function removeProblemDataCookie(){$.removeCookie(problemDataCookieKey,{expires:1,path:"/",domain:".chunyuyisheng.com"}),$.removeCookie(problemDataCookieKey,{expires:1,path:"/",domain:".chunyu.mobi"})}var cyUploader=require(1);require(2),require(4);var URL_CREATE_PROBLEM="/newhome/api/my_problem/create/",URL_LOGIN="/newhome/login/?next=/newhome/new_problem/",URL_MY_PROBLEM="/newhome/my_problem/",problemDataCookieKey="ask_new_problem_data",isUploading=!1,_uploader=cyUploader({browse_button:"btn-choose-img",init:{PostInit:function(e){console.log("uploader init!")},FilesAdded:function(e,o){console.log("已选择文件个数："+o.length),plupload.each(o,function(e){$("#img-list").append('<span class="up-file-img" id="up-file-'+e.id+'"><i class="fa fa-cloud-upload"><span class="up-file-percent"></span></i></span>')}),isUploading=!0,e.start()},FileUploaded:function(e,o,i){var t=JSON.parse(i.response).file;$("#up-file-"+o.id).html('<img class="up-file-img-preview" src="'+t+'" />')},UploadProgress:function(e,o){100==o.percent&&(o.percent=99),$("#up-file-"+o.id).find(".up-file-percent").text(o.percent+"%")},UploadComplete:function(e,o){updateUploadedImgCount(),isUploading=!1},Error:function(e,o){$("#up-file-"+o.file.id).remove(),$(".error-msg-container").alertShow("上传失败，请重试")}}});$("#btn-submit").on("click",function(){var e,o,i=$(this),t=[];return $(".error-msg-container").alertHide(),e=getProblemData(),(o=validateProblemData(e))?void $(".error-msg-container").alertShow(o):window._IS_USER_LOGIN?(t.push({type:"text",text:e.content}),t.push({type:"patient_meta",sex:e.gender,age:e.age}),$.each($(".up-file-img-preview"),function(e,o){t.push({type:"image",file:$(o).prop("src")})}),removeProblemDataCookie(),i.button("loading"),void $.ajax({url:URL_CREATE_PROBLEM,cache:!1,type:"post",data:{content:JSON.stringify(t)},contentType:"application/json; charset=utf-8",dataType:"json"}).always(function(){i.button("reset")}).done(function(e){var o;e.times_used_out?($(".ask-main").hide(),$(".no-free-problem").show()):e.success&&e.problem_id?(console.log("成功提交问题："+e.problem_id),window.location.href=URL_MY_PROBLEM+"#problem_id="+e.problem_id):(o=e.error_msg||"问题提交失败，请重试！",$(".error-msg-container").alertShow(o))})):(saveProblemDataToCookie(e),void(window.location.href=URL_LOGIN))});var isUploaderInit=!1;$("#btn-add-img").on("click",function(){var e=$("#btn-add-img"),o=e.offset(),i=$(window).width()-o.left-e.outerWidth(),t=$("#img-upload-panel");t.toggle().css("right",i).offset({top:o.top+45}),t.is(":visible")&&!isUploaderInit&&(_uploader.init(),isUploaderInit=!0)}),$("#img-upload-panel").bodyClickHide("#btn-add-img"),$(function(){restoreProblemDataFromCookie()});
},{"1":1,"2":2,"4":4}],4:[function(require,module,exports){
"use strict";!function(){function t(t){var e=null;if(document.cookie&&""!=document.cookie)for(var n=document.cookie.split(";"),o=0;o<n.length;o++){var c=jQuery.trim(n[o]);if(c.substring(0,t.length+1)==t+"="){e=decodeURIComponent(c.substring(t.length+1));break}}return e}function e(t){var e=document.location.host,n=document.location.protocol,o="//"+e,c=n+o;return t==c||t.slice(0,c.length+1)==c+"/"||t==o||t.slice(0,o.length+1)==o+"/"||!/^(\/\/|http:|https:).*/.test(t)}function n(t){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(t)}try{$(document).on("ajaxSend.csrf",function(o,c,r){!n(r.type)&&e(r.url)&&c.setRequestHeader("X-CSRFToken",t("csrftoken"))})}catch(o){}}();
},{}]},{},[3]);
